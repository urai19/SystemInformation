{"version":3,"file":"middlewareRunner.js","sourceRoot":"","sources":["../../../src/middleware/middlewareRunner.ts"],"names":[],"mappings":"AAEA;IAAA;QACmB,iBAAY,GAAiB,EAAE,CAAC;IAqCnD,CAAC;IAnCC;;;;;;;OAOG;IACH,8BAAG,GAAH,UAAI,UAAsB;QACxB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IACrC,CAAC;IAED;;;;;OAKG;IACH,8BAAG,GAAH,UAAI,OAA0B,EAAE,IAAoB;QAApD,iBAgBC;QAfC,IAAI,kBAAkB,GAAG,CAAC,CAAC,CAAC;QAC5B,IAAM,eAAe,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC;QAEjD,IAAM,cAAc,GAAmB,UAAA,UAAU;YAC/C,kBAAkB,IAAI,CAAC,CAAC;YACxB,IAAI,kBAAkB,GAAG,eAAe,EAAE;gBACxC,KAAI,CAAC,YAAY,CAAC,kBAAkB,CAAC,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;aAC1D;iBAAM;gBACL,IAAI,CAAC,UAAU,CAAC,CAAC;aAClB;QACH,CAAC,CAAC;QAEF,IAAM,KAAK,GAAmB,eAAe,GAAG,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC;QAE1E,KAAK,CAAC,OAAO,CAAC,CAAC;IACjB,CAAC;IACH,uBAAC;AAAD,CAAC,AAtCD,IAsCC","sourcesContent":["import { Middleware, MiddlewarePayload, MiddlewareNext } from '@amplitude/types';\n\nexport class MiddlewareRunner {\n  private readonly _middlewares: Middleware[] = [];\n\n  /**\n   * Add a @middleware to the chain.\n   *\n   * The provided middleware must call next(payload) for the chain to continue.\n   * Otherwise any following middleware and next method will not be called.\n   *\n   * @param middleware A Middleware function\n   */\n  add(middleware: Middleware): void {\n    this._middlewares.push(middleware);\n  }\n\n  /**\n   * Runs the middleware chain with the given payload.\n   *\n   * @param payload The payload data for the middleware to receive\n   * @param next The function to call after all middleware completes. Only runs if next(payload) is called by all middlewares.\n   */\n  run(payload: MiddlewarePayload, next: MiddlewareNext): void {\n    let curMiddlewareIndex = -1;\n    const middlewareCount = this._middlewares.length;\n\n    const middlewareNext: MiddlewareNext = curPayload => {\n      curMiddlewareIndex += 1;\n      if (curMiddlewareIndex < middlewareCount) {\n        this._middlewares[curMiddlewareIndex](curPayload, _next);\n      } else {\n        next(curPayload);\n      }\n    };\n\n    const _next: MiddlewareNext = middlewareCount > 0 ? middlewareNext : next;\n\n    _next(payload);\n  }\n}\n"]}