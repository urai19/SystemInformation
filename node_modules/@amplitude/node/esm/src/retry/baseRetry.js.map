{"version":3,"file":"baseRetry.js","sourceRoot":"","sources":["../../../src/retry/baseRetry.ts"],"names":[],"mappings":";AACA,OAAO,EAAE,qBAAqB,EAAE,MAAM,eAAe,CAAC;AACtD,OAAO,EAAE,eAAe,EAAE,MAAM,cAAc,CAAC;AAE/C;IAKE,0BAAmB,MAAc,EAAE,OAA8B;QAA9B,wBAAA,EAAA,YAA8B;;QAC/D,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;QACtB,IAAI,CAAC,QAAQ,yBAAQ,eAAe,GAAK,OAAO,CAAE,CAAC;QACnD,IAAI,CAAC,UAAU,SAAG,IAAI,CAAC,QAAQ,CAAC,cAAc,mCAAI,qBAAqB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACzF,CAAC;IAED;;OAEG;IACU,8CAAmB,GAAhC,UAAiC,MAAwB;;;;;4BAC5B,qBAAM,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,EAAA;;wBAAhF,QAAQ,GAAa,SAA2D;wBACtF,sBAAO,QAAQ,EAAC;;;;KACjB;IAES,6CAAkB,GAA5B;QACE,IAAI,OAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,KAAK,QAAQ,EAAE;YACjD,OAAO;gBACL,OAAO,EAAE;oBACP,aAAa,EAAE,IAAI,CAAC,QAAQ,CAAC,WAAW;iBACzC;aACF,CAAC;SACH;QACD,OAAO,EAAE,CAAC;IACZ,CAAC;IAES,sCAAW,GAArB,UAAsB,MAAwB;QAC5C,kBACE,OAAO,EAAE,IAAI,CAAC,OAAO,EACrB,MAAM,QAAA,IACH,IAAI,CAAC,kBAAkB,EAAE,EAC5B;IACJ,CAAC;IACH,uBAAC;AAAD,CAAC,AArCD,IAqCC","sourcesContent":["import { Event, Options, Transport, Payload, PayloadOptions, Response, Retry } from '@amplitude/types';\nimport { setupDefaultTransport } from '../transports';\nimport { DEFAULT_OPTIONS } from '../constants';\n\nexport class BaseRetryHandler implements Retry {\n  protected readonly _apiKey: string;\n  protected readonly _options: Options;\n  protected readonly _transport: Transport;\n\n  public constructor(apiKey: string, options: Partial<Options> = {}) {\n    this._apiKey = apiKey;\n    this._options = { ...DEFAULT_OPTIONS, ...options };\n    this._transport = this._options.transportClass ?? setupDefaultTransport(this._options);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public async sendEventsWithRetry(events: readonly Event[]): Promise<Response> {\n    const response: Response = await this._transport.sendPayload(this._getPayload(events));\n    return response;\n  }\n\n  protected _getPayloadOptions(): { options?: PayloadOptions } {\n    if (typeof this._options.minIdLength === 'number') {\n      return {\n        options: {\n          min_id_length: this._options.minIdLength,\n        },\n      };\n    }\n    return {};\n  }\n\n  protected _getPayload(events: readonly Event[]): Payload {\n    return {\n      api_key: this._apiKey,\n      events,\n      ...this._getPayloadOptions(),\n    };\n  }\n}\n"]}